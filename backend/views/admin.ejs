<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NextServe</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="/style/style.css" />

    <style>
      .app-card {
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      }

      .app-card-header {
        padding: 0.75rem 1.25rem;
        font-weight: 600;
        border-bottom: 1px solid #eee;
      }

      .call-btn {
        width: 36px;
        height: 36px;
      }

      .list-group-item {
        padding: 1rem 1.25rem;
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container mt-4">
      <!-- HEADER -->
      <div class="text-center mb-4">
        <h2 class="fw-bold">Queue Admin Panel</h2>
        <p class="text-muted">Manage customer queue in real time</p>
      </div>

      <!-- FLASH MESSAGES -->
      <% if (success && success.length > 0) { %>
      <div class="alert alert-success alert-dismissible fade show">
        <%= success[0] %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% } %> <% if (typeof serverMsg !== 'undefined' && serverMsg.length > 0) {
      %>
      <div class="alert alert-warning alert-dismissible fade show">
        <%= serverMsg[0] %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% } %> <% if (error && error.length > 0) { %>
      <div class="alert alert-danger alert-dismissible fade show">
        <%= error[0] %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% } %>

      <!-- MAIN ROW -->
      <div class="row g-4">
        <!-- LEFT SECTION -->
        <div class="col-lg-8 d-flex flex-column gap-4">
          <!-- NOW SERVING -->
          <div class="app-card text-center py-4">
            <h6 class="text-muted mb-1">Now Serving</h6>
            <h1 class="display-4 text-primary fw-bold" id="nowServing">
              <%= queue.currentServing ? queue.currentServing : "-" %>
            </h1>
          </div>

          <!-- ACTION BUTTONS -->
          <div class="d-flex align-items-center gap-3">
            <button id="callNextBtn" class="btn btn-success px-4">
              Call Next
            </button>

            <button id="resetQueueBtn" class="btn btn-danger px-4">
              Reset Queue
            </button>

            <a
              href="/admin/display"
              target="_blank"
              class="btn btn-outline-dark ms-auto"
            >
              Display
            </a>
          </div>

          <!-- QUEUE LIST -->
          <div class="app-card">
            <div class="app-card-header">Current Queue</div>

            <ul class="list-group list-group-flush" id="queueList">
              <% if (queue.tokens.length === 0) { %>
              <li class="list-group-item text-center text-muted">
                No customers in queue
              </li>
              <% } %> <% queue.tokens.forEach(t => { %>
              <li
                class="list-group-item d-flex justify-content-between align-items-center"
              >
                <!-- LEFT INFO -->
                <div>
                  <strong>Token #<%= t.tokenNo %></strong>
                  <div class="mt-1">
                    <div class="fw-semibold"><%= t.name %></div>
                    <div class="text-muted small"><%= t.phone %></div>
                  </div>
                </div>

                <!-- RIGHT ACTIONS -->
                <div class="d-flex align-items-center gap-2">
                  <a
                    href="tel:<%= t.phone %>"
                    class="btn btn-success btn-sm rounded-circle d-flex align-items-center justify-content-center call-btn"
                    title="Call customer"
                  >
                    <i class="bi bi-telephone-fill"></i>
                  </a>

                  <button
                    class="btn btn-sm btn-outline-danger delete-btn"
                    data-token="<%= t.tokenNo %>"
                    title="Delete user"
                  >
                    <i class="bi bi-trash-fill"></i>
                  </button>

                  <span
                    class="badge rounded-pill px-3 <%= t.status === 'called' ? 'bg-success' : 'bg-warning text-dark' %>"
                  >
                    <%= t.status.toUpperCase() %>
                  </span>
                </div>
              </li>
              <% }) %>
            </ul>
          </div>
        </div>

        <!-- RIGHT SECTION -->
        <div class="col-lg-4">
          <div class="card shadow-lg h-100 border-0 rounded-4">
            <!-- HEADER -->
            <div
              class="card-header bg-primary text-white text-center py-3 rounded-top-4"
            >
              <h5 class="mb-0 fw-bold">Daily Token Summary</h5>
              <small class="opacity-75">Total visitors per day</small>
            </div>

            <!-- BODY -->
            <div class="card-body p-0">
              <ul class="list-group list-group-flush">
                <% if (Object.keys(dailyStats).length === 0) { %>
                <li class="list-group-item text-muted text-center py-4">
                  No data available yet
                </li>
                <% } %> <% Object.keys(dailyStats).reverse().forEach(date => {
                %>
                <li
                  class="list-group-item d-flex justify-content-between align-items-center px-4 py-3"
                >
                  <div class="fw-semibold"><%= date %></div>
                  <span class="badge bg-success rounded-pill fs-6 px-3 py-2">
                    <%= dailyStats[date] %>
                  </span>
                </li>
                <% }) %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/admin.js"></script>
  </body>
</html>
